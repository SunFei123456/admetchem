# 用户认证系统使用指南

## 概述

ADMETchem 项目已完成用户注册登录模块的开发，包括完整的后端API和前端界面。

## 功能特性

### 后端功能

1. **用户注册** (`POST /api/v1/users/register`)
   - 邮箱和用户名唯一性验证
   - 密码加密存储（bcrypt）
   - 密码强度要求：至少6位

2. **用户登录** (`POST /api/v1/users/login`)
   - JWT令牌认证
   - 令牌有效期：30分钟（可配置）
   - 自动检查用户激活状态

3. **获取当前用户信息** (`GET /api/v1/users/me`)
   - 需要Bearer Token认证
   - 返回当前登录用户信息

4. **更新用户信息** (`PUT /api/v1/users/me`)
   - 修改用户名
   - 修改密码（需要验证旧密码）
   - 用户名唯一性验证

### 前端功能

1. **登录页面** (`/login`)
   - 邮箱和密码输入
   - 密码可见性切换
   - 自动跳转到首页

2. **注册页面** (`/register`)
   - 用户名、邮箱、密码输入
   - 密码强度提示
   - 密码确认验证
   - 注册成功后跳转到登录页

3. **个人中心** (`/profile`)
   - 显示用户详细信息
   - 修改用户名
   - 修改密码
   - 退出登录

4. **导航栏集成**
   - 未登录：显示"登录"和"注册"按钮
   - 已登录：显示用户名和下拉菜单
   - 下拉菜单包含"个人中心"和"退出登录"

## 启动指南

### 后端启动

1. **安装依赖**（如果还没安装 python-jose）
   ```bash
   cd backend
   # 激活虚拟环境
   .\venv_admet_py311\Scripts\activate
   
   # 安装新依赖
   pip install python-jose[cryptography]
   ```

2. **确保数据库已创建**
   ```sql
   CREATE DATABASE admetchem_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **初始化数据库表**
   ```bash
   python -c "from app.core.database import create_tables; create_tables()"
   ```

4. **启动服务器**
   ```bash
   python run.py
   ```

5. **访问API文档**
   - Swagger UI: http://localhost:8000/docs
   - 可以在这里测试所有API接口

### 前端启动

1. **安装依赖**（如果需要）
   ```bash
   cd ..
   pnpm install
   ```

2. **启动开发服务器**
   ```bash
   pnpm run dev
   ```

3. **访问应用**
   - 开发环境: http://localhost:5173
   - 点击导航栏的"注册"按钮开始

## API接口说明

### 1. 用户注册

**请求:**
```http
POST /api/v1/users/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "is_active": true
}
```

**响应:**
```json
{
  "code": 0,
  "message": "注册成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "is_active": true,
    "created_at": "2025-10-17T10:00:00",
    "updated_at": null
  }
}
```

### 2. 用户登录

**请求:**
```http
POST /api/v1/users/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123"
}
```

**响应:**
```json
{
  "code": 0,
  "message": "登录成功",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "is_active": true,
      "created_at": "2025-10-17T10:00:00"
    },
    "token": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "bearer"
    }
  }
}
```

### 3. 获取当前用户信息

**请求:**
```http
GET /api/v1/users/me
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**响应:**
```json
{
  "code": 0,
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "is_active": true,
    "created_at": "2025-10-17T10:00:00"
  }
}
```

### 4. 更新用户信息

**请求（修改用户名）:**
```http
PUT /api/v1/users/me
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "username": "newusername"
}
```

**请求（修改密码）:**
```http
PUT /api/v1/users/me
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "old_password": "password123",
  "new_password": "newpassword456"
}
```

**响应:**
```json
{
  "code": 0,
  "message": "更新成功",
  "data": {
    "id": 1,
    "username": "newusername",
    "email": "test@example.com",
    "is_active": true,
    "created_at": "2025-10-17T10:00:00",
    "updated_at": "2025-10-17T11:00:00"
  }
}
```

## 配置说明

### JWT配置

在 `backend/app/core/config.py` 中可以配置：

```python
# JWT密钥（生产环境请使用强密钥）
SECRET_KEY: str = "your-secret-key-here"

# JWT算法
ALGORITHM: str = "HS256"

# Token过期时间（分钟）
ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
```

建议在生产环境中通过环境变量设置：
```bash
# .env 文件
SECRET_KEY=your-very-strong-secret-key-here
ACCESS_TOKEN_EXPIRE_MINUTES=60
```

### 数据库配置

在 `backend/app/core/config.py` 中：

```python
DATABASE_URL: str = "mysql+pymysql://root:123456@localhost/admetchem_db"
```

可以通过 `.env` 文件配置：
```bash
DATABASE_URL=mysql+pymysql://username:password@localhost/dbname
```

## 安全特性

1. **密码加密**: 使用bcrypt算法，不存储明文密码
2. **JWT令牌**: 基于时间的访问令牌，自动过期
3. **路由守卫**: 前端自动拦截需要登录的页面
4. **请求拦截**: 自动在请求头添加认证令牌
5. **CORS配置**: 限制跨域访问源

## 错误代码

| 错误码 | 说明 |
|--------|------|
| 10001 | 邮箱已被注册 |
| 10002 | 用户名已被使用 |
| 10003 | 邮箱或密码错误 |
| 10004 | 用户不存在 |
| 10005 | 用户账号已被禁用 |
| 10006 | 更新失败（旧密码错误） |

## 测试建议

1. **注册新用户**
   - 访问 http://localhost:5173/#/register
   - 输入用户信息并注册

2. **登录**
   - 访问 http://localhost:5173/#/login
   - 使用注册的账号登录

3. **访问个人中心**
   - 登录后点击导航栏的用户名
   - 选择"个人中心"

4. **修改信息**
   - 在个人中心修改用户名或密码
   - 测试各种验证场景

5. **退出登录**
   - 点击"退出登录"按钮
   - 验证是否正确清除认证信息

## 常见问题

### Q1: Token过期后如何处理？

前端会在Token过期后自动跳转到登录页。用户需要重新登录获取新Token。

### Q2: 如何查看数据库中的用户？

使用MySQL客户端：
```sql
USE admetchem_db;
SELECT * FROM users;
```

### Q3: 忘记密码怎么办？

目前没有实现找回密码功能。可以通过数据库直接修改，或联系管理员。

### Q4: 如何添加管理员角色？

可以在 `User` 模型中添加 `role` 字段，然后在路由守卫中检查角色权限。

## 下一步开发建议

1. **邮箱验证**: 注册时发送验证邮件
2. **找回密码**: 通过邮箱重置密码
3. **用户角色**: 区分普通用户和管理员
4. **登录历史**: 记录用户登录时间和IP
5. **第三方登录**: 支持Google、GitHub等OAuth登录
6. **Token刷新**: 实现refresh token机制
7. **两步验证**: 增强账户安全性

## 技术栈

### 后端
- FastAPI: Web框架
- SQLAlchemy: ORM
- PyMySQL: MySQL驱动
- Passlib: 密码加密
- Python-JOSE: JWT处理
- Pydantic: 数据验证

### 前端
- Vue 3: UI框架
- Vue Router: 路由管理
- Axios: HTTP客户端
- Tailwind CSS: 样式框架

## 联系方式

如有问题或建议，请联系开发团队。

